<!DOCTYPE html>
<html lang="fr" data-theme="light">

<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-Z7PLKRXZNQ"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'G-Z7PLKRXZNQ');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/svg+xml" href="favicon.svg">

    <!-- Security Headers -->
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="SAMEORIGIN">
    <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">
    <meta http-equiv="Permissions-Policy" content="geolocation=(), microphone=(), camera=()">

    <title>Isaiah ‚Äî Dis-le. Gu√©ris.</title>
    <meta name="description"
        content="Isaiah - Une plateforme √©pur√©e pour partager vos √©crits personnels. Po√©sie, fiction, essais et r√©flexions.">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Crimson+Pro:ital,wght@0,400;0,500;0,600;1,400;1,500&family=Inter:wght@400;500;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="styles.css">

    <!-- DOMPurify for XSS Protection -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.0.6/purify.min.js"
        integrity="sha512-H+rglffZ6f5gF7UJgvH4Naa+fGCgjrHKMgoFOGmcPTRwR6oILo5R+gtzNrpDp7iMV3udbymBVjkeZGNz1Em0kQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <!-- Google Tag Manager -->
    <script>(function (w, d, s, l, i) {
            w[l] = w[l] || []; w[l].push({
                'gtm.start':
                    new Date().getTime(), event: 'gtm.js'
            }); var f = d.getElementsByTagName(s)[0],
                j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : ''; j.async = true; j.src =
                    'https://www.googletagmanager.com/gtm.js?id=' + i + dl; f.parentNode.insertBefore(j, f);
        })(window, document, 'script', 'dataLayer', 'GTM-PWJ8KG43');</script>
    <!-- End Google Tag Manager -->
</head>

<body>
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PWJ8KG43" height="0" width="0"
            style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->

    <!-- Header -->
    <header class="header">
        <div class="header-container">
            <a href="#" class="logo" data-page="home">
                <svg class="logo-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 19l7-7 3 3-7 7-3-3z" />
                    <path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z" />
                    <path d="M2 2l7.586 7.586" />
                    <circle cx="11" cy="11" r="2" />
                </svg>
                <span class="logo-text">Isaiah</span>
            </a>
            <nav class="nav">
                <button class="nav-link active" data-page="home">Biblioth√®que</button>
                <button class="nav-link" data-page="write" style="display:none">√âcrire</button>
                <button class="nav-link" data-page="profile" style="display:none">Profil</button>
            </nav>
            <div class="header-actions">
                <button class="theme-toggle" id="themeToggle" aria-label="Changer le th√®me">
                    <svg class="sun-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="5" />
                        <path
                            d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" />
                    </svg>
                    <svg class="moon-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" />
                    </svg>
                </button>
                <button class="auth-btn" id="authBtn" title="Connexion / Inscription">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" />
                        <circle cx="12" cy="7" r="4" />
                    </svg>
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main">
        <!-- Home Page -->
        <section id="page-home" class="page active">
            <div class="page-header">
                <div>
                    <h1 class="page-title">Biblioth√®que</h1>
                    <p class="page-subtitle">D√©couvrez les √©crits de la communaut√©</p>
                </div>
                <button class="btn btn-primary admin-only" data-page="write">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 5v14M5 12h14" />
                    </svg>
                    Nouvel √âcrit
                </button>
            </div>

            <!-- Filters -->
            <div class="filters">
                <div class="filter-group">
                    <button class="filter-btn active" data-filter="all">Tous</button>
                    <button class="filter-btn" data-filter="poetry">Po√©sie</button>
                    <button class="filter-btn" data-filter="fiction">Fiction</button>
                    <button class="filter-btn" data-filter="essay">Essai</button>
                    <button class="filter-btn" data-filter="reflection">R√©flexion</button>
                </div>
                <div class="filter-group" data-admin-only>
                    <button class="filter-btn" data-visibility="all">üìñ Tous</button>
                    <button class="filter-btn" data-visibility="public">üåç Publics</button>
                    <button class="filter-btn" data-visibility="private">üîí Priv√©s</button>
                </div>
            </div>

            <!-- Writings Grid -->
            <div class="writings-grid" id="writingsGrid">
                <!-- Writings will be inserted here -->
            </div>

            <!-- Empty State -->
            <div class="empty-state" id="emptyState">
                <div class="empty-icon">‚úçÔ∏è</div>
                <h2>Aucun √©crit pour le moment</h2>
                <p>L'auteur n'a pas encore publi√© d'√©crits. Revenez bient√¥t !</p>
                <button class="btn btn-primary admin-only" data-page="write">Cr√©er mon premier √©crit</button>
            </div>
        </section>

        <!-- Write/Edit Page (Admin Only) -->
        <section id="page-write" class="page">
            <div class="editor-container">
                <div class="editor-header">
                    <button class="btn btn-ghost back-btn" data-page="home">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M19 12H5M12 19l-7-7 7-7" />
                        </svg>
                        Retour
                    </button>
                    <div class="editor-actions">
                        <button class="btn btn-ghost" id="previewToggle">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" />
                                <circle cx="12" cy="12" r="3" />
                            </svg>
                            Aper√ßu
                        </button>
                        <button class="btn btn-primary" id="saveWriting">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z" />
                                <polyline points="17 21 17 13 7 13 7 21" />
                                <polyline points="7 3 7 8 15 8" />
                            </svg>
                            Sauvegarder
                        </button>
                    </div>
                </div>

                <div class="editor-meta">
                    <input type="text" id="writingTitle" class="title-input" placeholder="Titre de votre √©crit..."
                        maxlength="100">

                    <div class="meta-row">
                        <div class="meta-field">
                            <label>Cat√©gorie</label>
                            <select id="writingCategory" class="select-input">
                                <option value="poetry">Po√©sie</option>
                                <option value="fiction">Fiction</option>
                                <option value="essay">Essai</option>
                                <option value="reflection">R√©flexion</option>
                                <option value="other">Autre</option>
                            </select>
                        </div>
                        <div class="meta-field">
                            <label>Visibilit√©</label>
                            <div class="toggle-group">
                                <button class="toggle-btn active" data-visibility="private">
                                    üîí Priv√©
                                </button>
                                <button class="toggle-btn" data-visibility="public">
                                    üåç Public
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="meta-field tags-field">
                        <label>Tags</label>
                        <div class="tags-input-container">
                            <div class="tags-list" id="tagsList"></div>
                            <input type="text" id="tagsInput" class="tags-input"
                                placeholder="Ajouter un tag (Entr√©e pour valider)">
                        </div>
                    </div>
                </div>

                <div class="editor-body">
                    <div class="editor-pane" id="editorPane">
                        <div class="toolbar">
                            <button class="toolbar-btn" data-action="bold"
                                title="Gras (Ctrl+B)"><strong>G</strong></button>
                            <button class="toolbar-btn" data-action="italic"
                                title="Italique (Ctrl+I)"><em>I</em></button>
                            <span class="toolbar-divider"></span>
                            <button class="toolbar-btn" data-action="h1" title="Titre 1">H1</button>
                            <button class="toolbar-btn" data-action="h2" title="Titre 2">H2</button>
                            <button class="toolbar-btn" data-action="h3" title="Titre 3">H3</button>
                            <span class="toolbar-divider"></span>
                            <button class="toolbar-btn" data-action="quote" title="Citation">‚ùù</button>
                            <button class="toolbar-btn" data-action="list" title="Liste">‚Ä¢</button>
                        </div>
                        <textarea id="writingContent" class="editor-textarea"
                            placeholder="Commencez √† √©crire... (Markdown support√©)"></textarea>
                    </div>
                    <div class="preview-pane hidden" id="previewPane">
                        <div class="preview-content" id="previewContent"></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Read Page -->
        <section id="page-read" class="page">
            <article class="reading-container">
                <button class="btn btn-ghost back-btn" data-page="home">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M19 12H5M12 19l-7-7 7-7" />
                    </svg>
                    Retour √† la biblioth√®que
                </button>

                <header class="reading-header">
                    <div class="reading-meta">
                        <span class="reading-category" id="readCategory"></span>
                        <span class="reading-date" id="readDate"></span>
                        <span class="reading-visibility" id="readVisibility"></span>
                    </div>
                    <h1 class="reading-title" id="readTitle"></h1>
                    <div class="reading-tags" id="readTags"></div>
                </header>

                <div class="reading-content prose" id="readContent"></div>

                <div class="reading-author" id="readAuthor"></div>

                <footer class="reading-footer">
                    <button class="btn btn-ghost" id="editWritingBtn">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" />
                            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z" />
                        </svg>
                        Modifier
                    </button>
                    <button class="btn btn-ghost btn-danger" id="deleteWritingBtn">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="3 6 5 6 21 6" />
                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" />
                        </svg>
                        Supprimer
                    </button>
                </footer>
            </article>
        </section>

        <!-- Profile Page (Admin Only) -->
        <section id="page-profile" class="page">
            <div class="profile-container">
                <div class="profile-header">
                    <div class="profile-avatar" id="profileAvatar">I</div>
                    <div class="profile-info">
                        <span class="role-badge" id="roleBadge">‚úçÔ∏è √âcrivain</span>
                        <input type="text" class="profile-name" id="profileName" placeholder="Nom affich√©"
                            maxlength="50">
                        <input type="text" class="profile-username" id="profileUsername" placeholder="@pseudo"
                            maxlength="30" disabled>
                        <textarea class="profile-bio" id="profileBio" placeholder="√âcrivez votre biographie..."
                            maxlength="500"></textarea>
                        <button class="btn btn-primary btn-sm" id="saveProfileBtn">Sauvegarder le profil</button>
                    </div>
                </div>

                <div class="profile-stats">
                    <div class="stat">
                        <span class="stat-value" id="statTotal">0</span>
                        <span class="stat-label">√âcrits</span>
                    </div>
                    <div class="stat">
                        <span class="stat-value" id="statPublic">0</span>
                        <span class="stat-label">Publics</span>
                    </div>
                    <div class="stat">
                        <span class="stat-value" id="statPrivate">0</span>
                        <span class="stat-label">Priv√©s</span>
                    </div>
                </div>

                <div class="profile-section">
                    <h2>Mes √âcrits</h2>
                    <div class="writings-grid" id="myWritingsGrid"></div>
                    <div class="empty-state small" id="noMyWritings">
                        <p>Vous n'avez pas encore publi√© d'√©crits.</p>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Toast Notification -->
    <div class="toast" id="toast"></div>

    <!-- Delete Confirmation Modal -->
    <div class="modal-overlay" id="deleteModal">
        <div class="modal">
            <h3>Supprimer cet √©crit ?</h3>
            <p>Cette action est irr√©versible. L'√©crit sera d√©finitivement supprim√©.</p>
            <div class="modal-actions">
                <button class="btn btn-ghost" id="cancelDelete">Annuler</button>
                <button class="btn btn-danger" id="confirmDelete">Supprimer</button>
            </div>
        </div>
    </div>

    <!-- Auth Modal -->
    <div class="modal-overlay" id="authModal">
        <div class="modal auth-modal">
            <button class="modal-close" id="closeAuthModal">&times;</button>
            <div class="auth-tabs">
                <button class="auth-tab active" id="loginTab">Connexion</button>
                <button class="auth-tab" id="signupTab">Inscription</button>
            </div>

            <!-- Login Form -->
            <form id="loginForm" class="auth-form">
                <div class="form-group">
                    <label for="loginEmail">Email</label>
                    <input type="email" id="loginEmail" placeholder="votre@email.com" required>
                </div>
                <div class="form-group">
                    <label for="loginPassword">Mot de passe</label>
                    <input type="password" id="loginPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                </div>
                <button type="submit" class="btn btn-primary btn-full">Se connecter</button>
            </form>

            <!-- Signup Form -->
            <form id="signupForm" class="auth-form hidden">
                <div class="form-group">
                    <label for="signupEmail">Email</label>
                    <input type="email" id="signupEmail" placeholder="votre@email.com" required>
                </div>
                <div class="form-group">
                    <label for="signupUsername">Pseudo (unique)</label>
                    <input type="text" id="signupUsername" placeholder="mon_pseudo" required minlength="3"
                        maxlength="20">
                </div>
                <div class="form-group">
                    <label for="signupDisplayName">Nom affich√©</label>
                    <input type="text" id="signupDisplayName" placeholder="Votre Nom" required>
                </div>
                <div class="form-group">
                    <label for="signupPassword">Mot de passe</label>
                    <input type="password" id="signupPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required minlength="6">
                </div>
                <button type="submit" class="btn btn-primary btn-full">Cr√©er mon compte</button>
            </form>
        </div>
    </div>

    <script src="app.js"></script>
</body>

</html>